{% extends "layout.html" %}
{% block body %}

<style>


  table {
    width: 100%;
    border: 0px;
    background-color :#e7dfdf;
  }
  .box{
    border: 1px solid #a3a2a2; margin :0.5em 0em 0em 0em;
  }
  th {
    text-align : left;
    background-color: #e7dfdf;
  }

</style>

<HTML><HEAD><META content="IE=5.0000" http-equiv="X-UA-Compatible">
<TITLE></TITLE><LINK rel=stylesheet type=text/css href="/common/css/bok.css">
<SCRIPT src="/common/js/common.js"></SCRIPT>

<SCRIPT src="/common/js/udfMainFrm.js?ver=20180418"></SCRIPT>

<SCRIPT src="/common/js/IBSheetInfo.js"></SCRIPT>

<SCRIPT src="/common/js/IBSheetConfig.js"></SCRIPT>

<SCRIPT src="/common/js/showitem.js"></SCRIPT>
<!-- <script src="https://spi.maps.daum.net/imap/map_js_init/postcode.v2.js"></script> -->
<SCRIPT language=javascript> if(top.MainFrm) { set_url('/sale/cust/wes010.jsp'); }</SCRIPT>

<SCRIPT language=javascript>
function fnSessionCheck()
{
    if(top.SessionForm
    && top.SessionForm.user_id)
    {
        if(top.SessionForm.user_id.value != "s92694")
        {
            alert("같은 세션으로 다른 사용자로 로그인 하였습니다.\n다시 로그인 하시기 바랍니다.");
            top.close();
        }
    }
    else
    if(opener
    && opener.closed == false
    && opener.top.SessionForm
    && opener.top.SessionForm.user_id)
    {
        if(opener.top.SessionForm.user_id.value != "s92694")
        {
            alert("같은 세션으로 다른 사용자로 로그인 하였습니다.\n다시 로그인 하시기 바랍니다.");
            top.close();
            opener.top.close();
        }
    }
    else
    if(opener
    && opener.closed == false
    && opener.opener
    && opener.opener.closed == false
    && opener.opener.top.SessionForm
    && opener.opener.top.SessionForm.user_id)
    {
        if(opener.opener.top.SessionForm.user_id.value != "s92694")
        {
            alert("같은 세션으로 다른 사용자로 로그인 하였습니다.\n다시 로그인 하시기 바랍니다.");
            top.close();
            opener.top.close();
            opener.opener.top.close();
        }
    }
}
setTimeout("fnSessionCheck()",0);

if(window.name == 'MainFrm' && parent.SessionForm.pass_ch_option.value == '1')
{
    showModalDialog('/master/emp/passwd010.jsp?popup_fg=Y'
                   ,self
                   ,'dialogWidth:400px;dialogHeight:340px;dialogTop:100px;dialogLeft:100px;status:no;resizable:yes;scroll:no;');
}
</SCRIPT>
</HEAD>
<BODY>
<SCRIPT>if(parent && parent.HistoryFrm && parent.HistoryFrm.MainFrmPage && parent.HistoryFrm.MainFrmPage.pgm_nm && parent.HistoryFrm.MainFrmPage.pgm_nm.value != '') {document.write("<table width='100%' border='0' cellpadding='0' cellspacing='0' background='/image/title_bg.gif'><tr height='30'><td width='10'></td><td>  <table border='0' cellpadding='0' cellspacing='0'>  <tr>  <td><img src='/image/title_icon.gif'></td>  <td width='10'></td>  <td>    <table border='0' cellpadding='0' cellspacing='0'><tr><td height='3'></td></tr><tr>    <td><font color='#FFFFFF' style='font-size:14px;'><b>"+parent.HistoryFrm.MainFrmPage.pgm_nm.value+"</b></font></td>    </tr></table>  </td>  <td width='40'></td>  <td><span id='span_mymenu'></span></td>  <td width='10'></td>  <td><img src='/image/icon01/btn_column.gif'  onclick='parent.set_menu_item();' style='cursor:hand;'></td>  </tr>  </table></td><td align='right'><font color='#FFFFFF'>"+parent.HistoryFrm.MainFrmPage.pgm_lcls_nm.value+((parent.HistoryFrm.MainFrmPage.pgm_mcls_nm.value == '') ? '' : ' &gt; '+parent.HistoryFrm.MainFrmPage.pgm_mcls_nm.value)+' &gt; '+parent.HistoryFrm.MainFrmPage.pgm_nm.value+"</font></td><td width='10'></td></tr></table>");fnSetPgmId(parent.HistoryFrm.MainFrmPage.pgm_id.value);document.getElementById('span_mymenu').innerHTML = parent.HistoryFrm.getMyMenuStr(parent.HistoryFrm.MainFrmPage.pgm_id.value);}</SCRIPT>

<TABLE cellSpacing=0 cellPadding=0 width="100%" background=/image/title_bg.gif border=0>
<TBODY>
<TR height=30>
<TD width=10></TD>
<TD>
<TABLE cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR>
<TD><IMG src="/image/title_icon.gif"></TD>
<TD width=10></TD>
<TD>
<TABLE cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR>
<TD height=3></TD></TR>
<TR>
<TD><FONT style="FONT-SIZE: 14px" color=#ffffff><B>외상 발생/입금 내역</B></FONT></TD></TR></TBODY></TABLE></TD>
<TD width=40></TD>
<TD><SPAN id=span_mymenu><IMG onclick="top.HistoryFrm.fnEditMyMenu('Y','000526')" style="CURSOR: hand" src="https://asp.netusys.com/image/icon01/mymenu_plus.gif"></SPAN></TD>
<TD width=10></TD>
<TD><IMG onclick=parent.set_menu_item(); style="CURSOR: hand" src="/image/icon01/btn_column.gif"></TD></TR></TBODY></TABLE></TD>
<TD align=right><FONT color=#ffffff>회원관리 &gt; 회원분석 &gt; 외상 발생/입금 내역</FONT></TD>
<TD width=10></TD></TR></TBODY></TABLE>
<SCRIPT src="/common/js/select_box.js"></SCRIPT>

<FORM name=formAJAX action=/common/jsp/select_qry.jsp><INPUT id=select_source type=hidden value=/sale/cust/wes010.jsp name=select_source> <INPUT id=select_idx size=100 type=hidden name=select_idx> <INPUT id=select_objidx size=100 type=hidden name=select_objidx> <INPUT id=select_name size=100 type=hidden name=select_name> <INPUT id=select_value size=100 type=hidden name=select_value> <INPUT id=select_option size=100 type=hidden name=select_option> <INPUT id=select_query size=100 type=hidden name=select_query> <INPUT id=select_title size=100 type=hidden name=select_title> <INPUT id=select_change size=100 type=hidden name=select_change> <INPUT id=select_etc size=100 type=hidden name=select_etc> </FORM>
<SCRIPT src="/common/js/calendar2.js"></SCRIPT>

<DIV id=cal_div2 style="OVERFLOW: hidden; POSITION: absolute; Z-INDEX: 99; DISPLAY: none" name="cal_div2">
<TABLE cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR>
<TD><IFRAME id=cal_frm1 height=199 marginHeight=0 src="/common/jsp/calendar.html" frameBorder=0 width=162 name=cal_frm1 marginWidth=0 scrolling=no></IFRAME></TD>
<TD><IFRAME height=197 marginHeight=0 src="/common/jsp/blank.htm" frameBorder=0 width=2 marginWidth=0 scrolling=no></IFRAME></TD>
<TD><IFRAME id=cal_frm2 height=199 marginHeight=0 src="/common/jsp/calendar.html" frameBorder=0 width=162 name=cal_frm2 marginWidth=0 scrolling=no></IFRAME></TD></TR>
<TR>
<TD colSpan=3><IFRAME id=cal_close_frm height=28 marginHeight=0 src="/common/jsp/calendar_close.jsp?target=2" frameBorder=0 width=326 name=cal_close_frm marginWidth=0 scrolling=no></IFRAME></TD></TR></TBODY></TABLE></DIV>
<SCRIPT language=javascript>
function init_sheet()
{
    with(mySheet1)
    {
        //SheetWidth = document.body.clientWidth - 25;
        InitHostInfo(location.hostname, location.port, "");
        MergeSheet = msPrevColumnMerge;
        Editable = false;
        InitRowInfo( 1, 1, 1);
        InitColumnInfo(11, 0, 0, true);
        InitHeadRow(0,"매장코드|매장명|날짜|회원번호|회원명|외상금액|입금액|입금수단_코드|입금수단|승인로그|포스번호");
        //ObjId.InitDataProperty( DataRow, DataCol, [DataType], [Width], [DataAlign], [ColMerge], [SaveName], [KeyField]
        //                      , [CalcuLogic], [DataFormat],[PointCount], [UpdateEdit], [InsertEdit], [EditLen], [FullInput]
        //                      , [SortEnable],[ToolTip], [AllCheck], [SaveStatus], [FormatFix])
        i = 0;
        InitDataProperty(0,i++, dtHidden   , 0, daCenter  , true   ,"SHOP_CD"       , false , "", dfNone       , 0, false, false);
        InitDataProperty(0,i++, dtHidden   , 0, daLeft    , true   ,"SHOP_NM"       , false , "", dfNone       , 0, false, false);
        InitDataProperty(0,i++, dtData       , 0, daCenter  , true   ,"SALE_DATE"     , false , "", dfDateYmd    , 0, false, false);
        InitDataProperty(0,i++, dtData       , 0, daCenter  , true   ,"CST_NO"        , false , "", dfNone       , 0, false, false);
        InitDataProperty(0,i++, dtData       , 0, daCenter  , true   ,"CST_NM"        , false , "", dfNone       , 0, false, false);
        InitDataProperty(0,i++, dtAutoSum    , 0, daRight   , false  ,"WES_AMT"       , false , "", dfInteger    , 0, false, false);
        InitDataProperty(0,i++, dtAutoSum    , 0, daRight   , false  ,"WES_IN_AMT"    , false , "", dfInteger    , 0, false, false);
        InitDataProperty(0,i++, dtHidden     , 0, daCenter  , false  ,"PAY_TYPE_FG"   , false , "", dfNone       , 0, false, false);
        InitDataProperty(0,i++, dtData       , 0, daCenter  , false  ,"PAY_TYPE_NM"   , false , "", dfNone       , 0, false, false);
        InitDataProperty(0,i++, dtData       , 0, daCenter  , false  ,"APPR_LOG_NO"   , false , "", dfNone       , 0, false, false);
        InitDataProperty(0,i++, dtHidden     , 0, daCenter  , false  ,"POS_NO"        , false , "", dfNone       , 0, false, false);

        InitDataCombo(0,"PAY_TYPE_FG","현금|신용카드|제휴사용|제휴할인|상품권|외상|제휴적립|식권|회원포인트|사원카드|다음단골|캐쉬콘|모바일바코드|모바일쿠폰|캐시비|제휴혼합|선불카드|WeChat|전자상품권|O2O","01|02|03|04|05|06|07|08|09|10|11|12|13|15|16|18|19|20|21|26","","01")

        Visible = true;
    }
}
function doAction(str, idx)
{
    document.form1.S_METHOD.value = str;
    document.form1.SHEETSEQ.value = idx;
    sheet_obj = fnGetObjectIdName("mySheet"+idx);

    switch(str)
    {
        case "search":
            if(!valueCheck(document.form1.CST_NO,     '회원번호'    , 'Char'  ,  0,  10)) { return false; }
            if(!valueCheck(document.form1.CST_NM,     '회원명'      , 'Char'  ,  0,  12)) { return false; }

            sheet_obj.Visible = false;

            //초기화를 해주지 않으면 조회를 하고 난 직후에 해당컬럼과 데이터가 맞지 않게 설정되는 경우가 있어서 초기화를 해준다.
            sheet_obj.MoveColumnPos("SHOP_CD"   ,0);
            sheet_obj.MoveColumnPos("SHOP_NM"   ,1);
            sheet_obj.MoveColumnPos("SALE_DATE" ,2);
            sheet_obj.MoveColumnPos("CST_NO"    ,3);
            sheet_obj.MoveColumnPos("CST_NM"    ,4);

            sheet_obj.ShowDebugMsg = false;
            if(!jsSaveName(form1, sheet_obj)) { return false; }
            var param = FormQueryStringEnc(document.form1, sheet_obj);
            sheet_obj.DoSearch4Post("ddd.sheetAction",param);
            fn_ResizeColWidth(sheet_obj,[0, 0, 70, 50, 50, 60, 60, 60, 60, 40, 0]);
            moveCol(); // 컬럼이동
            sheet_obj.Visible = true;
            sheet_obj.ColFontColor('APPR_LOG_NO') = sheet_obj.RgbColor(0,0,255);
            break;

        case "down2Excel" :
            var orientation = "Landscape"; // Portrait (세로) | Landscape (가로)
            var except_cols = ""; // 엑셀에서 제외할 컬럼 (Hidden 컬럼 이외의 컬럼만)
            var excel_title = "회원미수금현황"; // 엑셀타이틀
            var excel_param = "조회기간 : " + document.form1.date1_1.value+" ~ "+document.form1.date1_2.value
                            + ((document.form1.CST_NO.value != '') ? ", 회원번호 : " + document.form1.CST_NO.value : "")
                            + ((document.form1.CST_NM.value != '') ? ", 회원명 : " + document.form1.CST_NM.value : "");
            fnUdfDown2Excel(sheet_obj, excel_title, orientation, except_cols, excel_param); // 엑셀출력함수
            break;
    }
    if(sheet_obj.EtcData("retMsg") && sheet_obj.EtcData("retMsg") != '' && sheet_obj.EtcData("retMsg") != '0000')
    {
        ErrorShow(sheet_obj.EtcData("retMsg")+'╋'+'https://asp.netusys.com/sale/cust/wes010.jsp', "popup", "");
    }
}
function fnShowDetail(Str, Row, Col)
{
    var sheet_obj   = fnGetObjectIdName("mySheet1");

    var url         = "";
    var width       = "300px";
    var height      = "350px";

    var SHOP_CD     = sheet_obj.CellValue(Row, "SHOP_CD");
    var SALE_DATE   = sheet_obj.CellValue(Row, "SALE_DATE");
    var APPR_LOG_NO = sheet_obj.CellValue(Row, "APPR_LOG_NO");
    var POS_NO      = sheet_obj.CellValue(Row, "POS_NO");
    var params      = "?SHOP_CD="+SHOP_CD+"&SALE_DATE="+SALE_DATE+"&APPR_LOG_NO="+APPR_LOG_NO+"&POS_NO="+POS_NO;

    //alert(params);

    if(Str == "csh_amt")
    {
        width   = "750px";
        height  = "210px";
        url     = "/sale/cust/wes010_cash_amt.jsp"+params;
    }
    else if(Str == "jcd_dc_amt")
    {
        width   = "900px";
        height  = "210px";
        url     = "/sale/cust/wes010_card_amt.jsp"+params;
    }
    showModalDialog(url,self,'dialogWidth:'+width+';dialogHeight:'+height+';dialogTop:200px;dialogLeft:200px;status:no;resizable:YES;scroll:no;');
}
function moveCol()
{
    sheet_obj = fnGetObjectIdName("mySheet1");
    var order_col = document.form1.ORDER_FG.value.split(',');
    sheet_obj.MoveColumnPos(order_col[0],0);
    sheet_obj.MoveColumnPos(order_col[1],1);
    sheet_obj.MoveColumnPos(order_col[2],2);
    sheet_obj.MoveColumnPos(order_col[3],3);
    sheet_obj.MoveColumnPos(order_col[4],4);

    var order_asc = new Array();
    order_asc[0] = ((order_col[0]=='SALE_DATE') ? 'DESC' : 'ASC');
    order_asc[1] = ((order_col[1]=='SALE_DATE') ? 'DESC' : 'ASC');
    order_asc[2] = ((order_col[2]=='SALE_DATE') ? 'DESC' : 'ASC');
    order_asc[3] = ((order_col[3]=='SALE_DATE') ? 'DESC' : 'ASC');
    order_asc[4] = ((order_col[4]=='SALE_DATE') ? 'DESC' : 'ASC');

    sheet_obj.ColumnSort(order_col[0]+'|'+order_col[1]+'|'+order_col[2]+'|'+order_col[3]+'|'+order_col[4],'ASC'
                        ,order_asc[0]+'|'+order_asc[1]+'|'+order_asc[2]+'|'+order_asc[3]+'|'+order_asc[4]);
}
/////////////////////////////////////// window.onload ///////////////////////////////////////
window.onload = function() { setTimeout("onloadFunctions()",0); }; function onloadFunctions()
{
    init_sheet(); set_item();
    fnResize();
}
/////////////////////////////////////// window.onresize ///////////////////////////////////////
window.onresize = function()
{
    fnResize();
}
/////////////////////////////////////// fnResize ///////////////////////////////////////
function fnResize()
{
    setObjHeight('mySheet1');
    fn_ResizeColWidth(mySheet1,[0, 0, 70, 50, 50, 60, 60, 60, 60, 40, 0]);
}
</SCRIPT>

<SCRIPT language=javascript for=mySheet1 event="OnMouseMove(Button, Shift, X, Y);">
if(MouseRow >= HeaderRows && MouseRow < HeaderRows+RowCount)
{
    //System.out.print (tmp);
    if(MouseCol == SaveNameCol('APPR_LOG_NO') && CellValue(MouseRow,MouseCol) != '')
    {
        MousePointer = "Hand";//alert (MouseCol);//alert (CellValue(MouseRow, MouseCol));
    }
}
</SCRIPT>

<SCRIPT language=javascript for=mySheet1 event=OnClick(Row,Col,Value);>
if(Col == SaveNameCol('APPR_LOG_NO') && CellValue(Row,'APPR_LOG_NO') != '')
{
    if(CellValue(Row,'PAY_TYPE_FG') == '01')    fnShowDetail("csh_amt"   ,Row,Col); // 현금영수증
    else                                        fnShowDetail("jcd_dc_amt",Row,Col); // 카드
}
</SCRIPT>

<FORM name=form1><!-- IBFrame 을 위한 변수 선언 (필수)--><INPUT type=hidden value=sale.cust.wes010 name=S_CONTROLLER> <INPUT type=hidden name=S_METHOD> <INPUT type=hidden name=S_SAVENAME> <!-- IBFrame 을 위한 변수 선언 (선택)--><INPUT type=hidden name=S_FORWARD> <INPUT type=hidden name=S_TREECOL> <INPUT type=hidden name=SHEETSEQ>
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=#e9e9e9 border=0>
<TBODY>
<TR height=2>
<TD colSpan=3></TD></TR>
<TR height=27>
<TD width=10></TD>
<TD>
<TABLE cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR height=25>
<TD><IMG src="/image/s_icon.gif"> 조회일자 <INPUT onclick=fnShowCal2(1); id=date1_1 class=read1hc style="CURSOR: hand" readOnly size=10 value=2018-07-23 name=date1_1> - <INPUT onclick=fnShowCal2(1); id=date1_2 class=read1hc style="CURSOR: hand" readOnly size=10 value=2018-07-23 name=date1_2> <IMG onclick=fnShowCal2(1); style="CURSOR: hand" src="/image/calendar/calendar_btn.gif"><INPUT id=date_period1 type=hidden value=366 name=date_period1></TD>
<TD width=5></TD>
<TD><INPUT type=hidden value=S92694 name=s_SHOP_CD></TD>
<TD width=5></TD>
<TD><IMG src="/image/s_icon.gif"> 회원번호 <INPUT onkeypress="if(event.keyCode == 13) { doAction('search','1'); }" class=input1hc maxLength=8 size=7 name=CST_NO></TD>
<TD width=5></TD>
<TD><IMG src="/image/s_icon.gif"> 회원명 <INPUT onkeypress="if(event.keyCode == 13) { doAction('search','1'); }" class="input1h imeHan" maxLength=12 size=11 name=CST_NM></TD>
<TD width=5></TD>
<TD>
<TABLE onclick="doAction('search','1')" style="CURSOR: pointer" cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR vAlign=middle>
<TD><IMG id=btn_l_bg src="/image/btn_black_l_bg.gif"></TD>
<TD background=/image/btn_black_c_bg.gif><IMG src="/image/blank.gif" width=4 height=13><FONT color=#ffffff>조회</FONT><IMG src="/image/blank.gif" width=4 height=13></TD>
<TD><IMG id=btn_r_bg src="/image/btn_black_r_bg.gif"></TD></TR></TBODY></TABLE></TD>
<TD width=5></TD>
<TD>
<TABLE onclick="doAction('down2Excel', '1')" style="CURSOR: pointer" cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR vAlign=middle>
<TD><IMG id=btn_l_bg src="/image/btn_black_l_bg.gif"></TD>
<TD background=/image/btn_black_c_bg.gif><IMG src="/image/blank.gif" width=4 height=13><FONT color=#ffffff>엑셀</FONT><IMG src="/image/blank.gif" width=4 height=13></TD>
<TD><IMG id=btn_r_bg src="/image/btn_black_r_bg.gif"></TD></TR></TBODY></TABLE></TD>
<TD width=5></TD></TR>
<TR height=25>
<TD><IMG src="/image/s_icon.gif"> 정&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;렬 <SELECT onchange=moveCol() name=ORDER_FG> <OPTION selected value=SHOP_CD,SHOP_NM,SALE_DATE,CST_NO,CST_NM>일자-회원</OPTION> <OPTION value=SHOP_CD,SHOP_NM,CST_NO,CST_NM,SALE_DATE>회원-일자</OPTION></SELECT></TD></TR></TBODY></TABLE></TD></TD>
<TD width=10></TD></TR>
<TR height=2>
<TD colSpan=3></TD></TR>
<TR height=1 bgColor=#d6d6d6>
<TD colSpan=3></TD></TR></TBODY></TABLE></FORM>
<TABLE height=6 cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD></TD></TR></TBODY></TABLE>
<TABLE id=TableNm1 height=30 cellSpacing=1 cellPadding=4 width="100%" bgColor=#aaaaaa border=0 name="TableNm1">
<TBODY>
<TR bgColor=#ffffff vAlign=top>
<TD height="100%" width="100%">
<SCRIPT>makeIBSheet('mySheet1','Merge');</SCRIPT>

<OBJECT id=mySheet1 style="HEIGHT: 481px" name=mySheet1 codeBase="/common/object/IBSheet3.CAB#version=3,4,0,387" classid=CLSID:341FBC5F-2AE4-41B8-BFE5-A03170569A27 width="100%" height="100%"><PARAM NAME="_ExtentX" VALUE="25982"><PARAM NAME="_ExtentY" VALUE="12726"><PARAM NAME="ConfigXml" VALUE="/common/gridstyle/GridConfigMerge.xml"><PARAM NAME="Version" VALUE="3.4.0.387"></OBJECT>
<SCRIPT>document.getElementById('mySheet1').SetExcelColDialog(0);</SCRIPT>
</TD></TR></TBODY></TABLE></BODY></HTML>

{% endblock %}